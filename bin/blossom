#!/usr/bin/env ruby

require 'fileutils'

include FileUtils

def file_sub(name, pattern, replacement)
  content = File.read(name)
  File.open(name, "w") do |file|
    file.write(content.sub(pattern, replacement))
  end
end

case ARGV.length
when 1
  project_name = ARGV.first
  unless File.exist? project_name
    blossom_root = File.dirname(__FILE__), ".."
    cp_r File.join(blossom_root, "example-app"), project_name
    cd project_name
    file_sub "config.ru", ":example", ":#{project_name}"
    file_sub "example.haml", "example.css", "#{project_name}.css"
    mv "example.haml", "#{project_name}.haml"
    mv "example.sass", "#{project_name}.sass"
    system "git init && git add -A && git commit -m 'Create project.'"
  else
    warn "#$0: file already exists: #{project_name}"
    exit -1
  end
else
  warn "Usage: #$0 PROJECT-NAME"
end
